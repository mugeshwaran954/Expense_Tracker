<%- include('partials/header') %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="text-primary-dark mb-0"><i class="fas fa-chart-line me-2"></i>Monthly Report</h2>
  <a href="/expenses/dashboard" class="btn btn-outline-primary">
    <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
  </a>
</div>

<div class="row g-4">
  <div class="col-md-5">
    <div class="card shadow-lg">
      <div class="card-header">Spending Summary</div>
      <div class="card-body">
        <div class="chart-container">
          <canvas id="monthlyChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-7">
    <div class="card shadow-lg">
      <div class="card-header"><i class="fas fa-list me-2"></i>Summary by Category</div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-striped mb-0">
            <thead>
              <tr>
                <th class="ps-3">Category</th>
                <th>Total Amount ($)</th>
              </tr>
            </thead>
            <tbody>
              <% if (reportData.length === 0) { %>
                <tr>
                  <td colspan="2" class="text-center text-muted p-4">No data for this month.</td>
                </tr>
              <% } else { %>
                <% let total = 0; %>
                <% reportData.forEach(row => { %>
                  <% total += row.total; %>
                  <tr>
                    <td class="ps-3"><%= row.category %></td>
                    <td>$<%= Number(row.total).toFixed(2) %></td>
                  </tr>
                <% }) %>
                <tr class="fw-bold table-light">
                  <td class="ps-3">Total Monthly Expense</td>
                  <td>$<%= Number(total).toFixed(2) %></td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const reportData = <%- JSON.stringify(reportData) %>;
  const labels = reportData.map(r => r.category);
  const totals = reportData.map(r => r.total);

  // New color palette
  const chartColors = [
    '#5b2eae', '#8a4ff7', '#c285ff', '#d9b3ff', '#f0e5ff',
    '#ff6384', '#36a2eb', '#ffce56', '#4bc0c0', '#9966ff'
  ];

  new Chart(document.getElementById('monthlyChart').getContext('2d'), {
    type: 'pie', // Pie chart might be nice for a report
    data: {
      labels: labels,
      datasets: [{
        label: 'Expenses ($)',
        data: totals,
        backgroundColor: chartColors,
        borderColor: '#fff',
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { 
          position: 'bottom', 
          labels: { color: '#222', font: { size: 14, family: 'Inter' } } 
        }
      }
    }
  });
</script>

<%- include('partials/footer') %>
